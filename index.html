<!doctype html>
<html>
<head>
    <!--   <meta http-equiv="Content-Type" content="text/html; charset=utf-8">-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Payment to the House Committee</title>
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css.css">

    <!--<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>-->
    <script type="text/javascript" src="jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script type="text/javascript">

        var jsonData;
        var sumToDeal;
        var ownerPay;

        // Create DynamicTable from Floor and Tenants num
        $(document).ready(function () {
            $("#CreateTable").click(function () {
                var DynamicTable = $('<table></table>').attr({ id: "DynamTable", class: "table table-bordered btn-sm" });
                var floor = ($("#floorNum").val());
                var TenantsFloor = ($("#TenantsFloors").val());
                var tr = [];
                var k = 0;

                for (var i = 0; i < floor; i++) {
                    var row = $('<tr></tr>').attr({ class: ["Info"].join(' ') }).appendTo(DynamicTable);
                    for (var j = 0; j < TenantsFloor; j++) {
                        $('<td></td>').text("text1").appendTo(row).addClass("tenant" + (k++)).addClass("tenants");
                    }
                }
                DynamicTable.appendTo("#box");
            });
        });


        // RefreshAjax
        $(document).ready(function () {

            // click event handler for refresh button
            $("#RefreshAjax").click(function () {
                $.get("data.json", function (data, status) {
                    data = $.parseJSON(data);
                    jsonData = data;
                    var totalBal = 0;

                    for (var i = 0; i < (data.length); i++) {
                        $("#tenant" + i).html('Apartment Number:' + data[i].ApartmentNumber + '<br /> ' + data[i].firstName + ' ' + data[i].lastName + '  is a ' + data[i].Type + '<br /> floor:' + data[i].floor);
                        totalBal += (data[i].balance);

                        if (data[i].balance < 0) {
                            $("#tenant" + i).css("background-color", "#EA4335").append("<br /> <button id='" + (data[i].ApartmentNumber) + "' type='button' class= 'btn btn-default'> Need Pay " + Math.abs(data[i].balance) + " ILS </button>");
                        } else {
                            $("#tenant" + i).css("background-color", "#4CAF50").append("<br /><br />");
                        }

                    }

                    $("#totalBalance").html(totalBal);

                    $("#main").show();
                });
            });



            // click event handler for pay button
            $(".tenants").click(function () {
                var selfId = this.id;
                var i = selfId.substr(-1);
                var ApartmentNumber;

                sumToDeal = (Math.abs(jsonData[i].balance));
                ownerPay = jsonData[i].firstName + ' ' + jsonData[i].lastName;
                ApartmentNumber =jsonData[i].ApartmentNumber;

                if (sumToDeal <= 0) { alert("no need pay"); return }

                $.post("https://secure.cardcom.co.il/Interface/LowProfile.aspx", {
                    Operation: "1",
                    TerminalNumber: "1000",
                    UserName: "barak9611",
                    SumToBill: sumToDeal,
                    CoinID: "1",
                    Language: "en",
                    ProductName: "House Committee",
                    CardOwnerName: ownerPay,
                    "InvoiceHeadOperation": "1",
                    "InvoiceHead.CustName": ownerPay,
                    "InvoiceHead.SendByEmail": false,
                    "InvoiceHead.Language": "en",
                    "InvoiceLines.Description": "House Committee",
                    "InvoiceLines.Price": sumToDeal,
                    "InvoiceLines.Quantity": 1,
                    "InvoiceLines.IsPriceIncludeVAT": true,
                     ReturnValue :ApartmentNumber,
                    //  "InvoiceHead.Email":"shayz2012@gmail.com",
                    APILevel: "10",
                    codepage: "65001",
                    SuccessRedirectUrl: "https://shayzdev.000webhostapp.com/Payment_to_the_House_Committee/SuccessPage.html",
                    ErrorRedirectUrl: "https://shayzdev.000webhostapp.com/Payment_to_the_House_Committee/ErrorPage.html",
                    IndicatorUrl: "https://shayzdev.000webhostapp.com/Payment_to_the_House_Committee/IndicatorUrl.php"
                }, function (data) {
                    var Result = decodeURIComponent(data);
                    var urlResult = Result.slice(86, 204);
                    window.location.href = urlResult;

                    //  var lpc = Result.slice(45, 81);
                    // alert(lpc);
                    //  var GETindicator = "https://secure.cardcom.co.il/Interface/BillGoldGetLowProfileIndicator.aspx?terminalnumber=1000&username=barak9611&lowprofilecode=";
                    //   var a = GETindicator + lpc;
                    //   alert(a);
                    //   $("#divResult").html(Result);
                });
            });

        });

    </script>
</head>
<body>

<div id="custom-bootstrap-menu" class="navbar navbar-default " role="navigation">
    <div class="container-fluid">
        <div class="navbar-header"><a class="navbar-brand" href="#">Payment House Committee</a>
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-menubuilder"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse navbar-menubuilder">
            <ul class="nav navbar-nav navbar-left">
                <li> <a href="about.html">About</a>
                </li>
                <li><a href="index.html" class="active">The Application</a>
                </li>
            </ul>
        </div>
    </div>
</div>



    <div class="container-fluid">
        <div class="table-responsive">
    
            Floor num:<input type="text" id="floorNum" />
            Tenants on the floor:<input type="text" id="TenantsFloors" />

            <input type="button" id="CreateTable" value="CreateTable" class="btn btn-default" />
            <button id="RefreshAjax" class="btn btn-default" >Refresh Ajax</button>
        

            <div id="box"></div>
            <div id="main" style="display:none">


                <table class="table  table-bordered btn-sm" >
                    <tr class="Info">
                        <td id="tenant0" class="tenants">
                        </td>
                        <td id="tenant1" class="tenants">
                        </td>
                    </tr>
                    <tr class="Info">
                        <td id="tenant2" class="tenants">
                        </td>
                        <td id="tenant3" class="tenants">
                        </td>
                    </tr>
                    <tr class="Info">
                        <td id="tenant4" class="tenants">
                        </td>
                        <td id="tenant5" class="tenants">
                        </td>
                    </tr>
                    <tr class="Info">
                        <td id="tenant6" class="tenants">
                        </td>
                        <td id="tenant7" class="tenants">
                        </td>
                    </tr>
                </table>

                <p > </p>

                <table class="Info">
                    <tr>
                        <td>
                        Total Balance :  
                        </td>
                        <td id="totalBalance">
                        </td>
                    </tr>
                </table>
                <b></b>
                
          <!--  <form>
                <input id="sum_input" type="text">
                <button id="pay_btn" type="button" class="btn btn-info">Pay2 </button>
                </form>
                <div id="divResult"></div>-->
            </div>
        </div>
    </div>
</body>
</html>
